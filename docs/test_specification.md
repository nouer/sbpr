# テスト仕様書

## 1. 単体テスト (bp.calc.test.js)

### 1.1 血圧分類テスト
| テストID | テスト内容 | 入力 | 期待結果 |
|----------|-----------|------|----------|
| UT-001 | 正常血圧の判定 | sys=110, dia=70 | "正常血圧" |
| UT-002 | 正常高値血圧の判定 | sys=120, dia=70 | "正常高値血圧" |
| UT-003 | 高値血圧の判定（収縮期） | sys=130, dia=70 | "高値血圧" |
| UT-004 | 高値血圧の判定（拡張期） | sys=110, dia=80 | "高値血圧" |
| UT-005 | I度高血圧の判定 | sys=140, dia=85 | "I度高血圧" |
| UT-006 | II度高血圧の判定 | sys=150, dia=95 | "II度高血圧" |
| UT-007 | III度高血圧の判定 | sys=165, dia=105 | "III度高血圧" |

### 1.2 統計計算テスト
| テストID | テスト内容 | 入力 | 期待結果 |
|----------|-----------|------|----------|
| UT-010 | 平均値計算 | [{sys:120,dia:80},{sys:130,dia:85}] | {avgSys:125, avgDia:82.5} |
| UT-011 | 最大/最小値 | [{sys:120,dia:80},{sys:140,dia:90}] | {maxSys:140, minSys:120, ...} |
| UT-012 | 空配列の平均値 | [] | null |

### 1.3 バリデーションテスト
| テストID | テスト内容 | 入力 | 期待結果 |
|----------|-----------|------|----------|
| UT-020 | 正常な入力 | sys=120, dia=80 | valid: true |
| UT-021 | 収縮期が範囲外（低） | sys=40, dia=80 | valid: false |
| UT-022 | 収縮期が範囲外（高） | sys=310, dia=80 | valid: false |
| UT-023 | 収縮期 <= 拡張期 | sys=80, dia=80 | valid: false |
| UT-024 | 脈拍が範囲外 | pulse=20 | valid: false |
| UT-025 | 体重の正常入力 | weight=65.5 | valid: true |
| UT-026 | 体重が範囲外（低） | weight=15 | valid: false |
| UT-027 | 体重が範囲外（高） | weight=310 | valid: false |
| UT-028 | 体重が未入力（任意） | weight=null | valid: true |

## 2. E2Eテスト (e2e.test.js)

### 2.1 基本操作テスト
| テストID | テスト内容 | 操作 | 期待結果 |
|----------|-----------|------|----------|
| E2E-001 | ページ表示 | トップページにアクセス | タイトルが表示される |
| E2E-002 | 血圧記録 | フォームに入力して保存 | 一覧に記録が追加される |
| E2E-003 | 記録削除 | 削除ボタンをクリック | 一覧から記録が消える |
| E2E-004 | グラフ表示 | グラフタブに切替 | グラフが描画される |
| E2E-005 | pageerror検知 | 全操作中 | JSエラーが発生しないこと |
| E2E-011 | 気分・体調・体重を記録 | 全フィールド入力して保存 | 一覧に表示される |

### 2.2 固定UI要素テスト
| テストID | テスト内容 | 操作 | 期待結果 |
|----------|-----------|------|----------|
| E2E-025 | バージョン情報表示 | トップページにアクセス | 右上にVer: / Build: が表示される |
| E2E-026 | スクロールトップボタン | トップページにアクセス | 左上にfixed配置のボタンが表示される |

### 2.3 入力フォームUXテスト
| テストID | テスト内容 | 操作 | 期待結果 |
|----------|-----------|------|----------|
| E2E-021 | 保存後に前回値がプリフィルされる | 血圧を記録して保存 | 保存後、最高血圧・最低血圧・脈拍に前回の値が入っている |
| E2E-022 | 初回アクセス時にプリフィルされる | 記録がある状態でページをリロード | フォームに直近の記録値がプリフィルされている |
| E2E-023 | プリフィル時に日時は現在時刻 | 記録保存後のフォームを確認 | 日時フィールドは前回の値ではなく現在に近い時刻が設定されている |
| E2E-024 | フォーカスで入力値が全選択される | 最高血圧フィールドにフォーカス | フィールドの値が全選択状態になる |

### 2.4 データ管理テスト
| テストID | テスト内容 | 操作 | 期待結果 |
|----------|-----------|------|----------|
| E2E-010 | エクスポート | エクスポートボタンクリック | JSONファイルがダウンロードされる |
| E2E-011 | インポート | JSONファイルを選択 | データがインポートされる |
| E2E-015 | エクスポートにプロフィール・AI備考・AIモデルが含まれる | プロフィール・AI備考・AIモデルを設定後エクスポート | JSON内にprofileオブジェクト、aiMemo、aiModelフィールドが含まれる |
| E2E-016 | インポートでプロフィール・AI備考・AIモデルが復元される | profile/aiMemo/aiModelを含むJSONをインポート | localStorageのプロフィール・AI備考・AIモデルが復元され、UIに反映される |

### 2.5 AI診断機能テスト
| テストID | テスト内容 | 操作 | 期待結果 |
|----------|-----------|------|----------|
| E2E-008 | AI診断タブ非表示 | APIキー未設定でアクセス | AI診断タブが非表示 |
| E2E-009 | AI診断タブ表示 | APIキー設定後にアクセス | AI診断タブが表示される |
| E2E-010 | AI備考保存 | 備考入力して保存 | localStorageに保存される |
| E2E-012 | 提案質問のパース | parseSuggestionsに候補付きテキストを渡す | mainContentとsuggestionsが正しく分離される |
| E2E-013 | 提案質問ボタン表示 | AI応答に{{SUGGEST:...}}を含むメッセージを表示 | .ai-suggestion-btnボタンが表示される |
| E2E-014 | 提案質問ボタンクリック | 提案ボタンをクリック | フォローアップとして質問が送信される |
| E2E-017 | AIモデル選択セレクト表示 | 設定タブのAI診断設定を確認 | ai-model-selectセレクトボックスが表示される |
| E2E-018 | AIモデル選択の初期値 | モデル未選択でアクセス | デフォルトでgpt-4o-miniが選択されている |
| E2E-019 | AIモデル選択の保存 | モデルを変更 | localStorageにsbpr_ai_modelキーで保存される |
| E2E-020 | AIモデル情報表示 | モデルを選択 | ai-model-info要素にモデル名・コンテキスト上限・価格が表示される |
